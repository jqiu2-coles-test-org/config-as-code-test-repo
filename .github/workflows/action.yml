name: Set Branch Protection

on:
  workflow_dispatch:
    inputs:
      token:
        description: 'This should have Admin privileges or should be an Org Level Owner'
        required: true
      org:
        description: 'The name of your GitHub organization'
        required: true
        default: "jqiu2-coles-test-org"
      rulesPath:
        description: 'The path of the rules json file for branch protection'
        default: './rules.json'
        required: true
      includedReposPath:
        description: 'Path of the file with repos (newline) to be included for optionally applying branch protection. If not provided, all repos will be considered.' 
      excludedReposPath:
        description: 'Path of the file with repos (newline separated) to be excluded for branch protection. This is optional.'
      action:
        description: 'Set or Add or Delete Branch protection. Default is set.'
        default: 'set'
        required: true


jobs:
  set-branch-protection:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up Node.js
      uses: actions/setup-node@v2
      with:
        node-version: '16'

    - name: Install dependencies
      run: npm install

    - name: Set-Branch-Protection
      uses: venh/branch-protection@v1.1.0
      with:
        token: ${{ github.event.inputs.token }}
        org: ${{ github.event.inputs.org }}
        rulesPath: ${{ github.event.inputs.rulesPath }}
        includedReposPath: ${{ github.event.inputs.includedReposPath }}
        excludedReposPath: ${{ github.event.inputs.excludedReposPath }}
        action: ${{ github.event.inputs.action }}

